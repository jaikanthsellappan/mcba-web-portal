@model IEnumerable<mcbaMVC.Models.BillPay>
@using System.Globalization
@{
    ViewData["Title"] = "BillPay";

    string D(DateTime dt) => dt.ToLocalTime().ToString("dd/MM/yyyy", CultureInfo.InvariantCulture);
    string T(DateTime dt) => dt.ToLocalTime().ToString("hh:mm tt", CultureInfo.InvariantCulture);
    string PeriodText(string? p) => p == "M" ? "Monthly" : "Once";
    string StatusText(string? s) => s switch
    {
        "S" => "Scheduled",
        "P" => "Processing",
        "D" => "Paid",
        "F" => "Failed",
        "C" => "Cancelled",
        _   => s ?? "—"
    };
}
<h2 class="mb-3">Scheduled Payments</h2>

@if (TempData["Toast"] is string toast)
{
    <div class="alert alert-success">@toast</div>
}

<p><a class="btn btn-outline-primary" asp-action="Create">Schedule New Payment</a></p>

@if (!Model.Any())
{
    <div class="text-muted">No scheduled payments yet.</div>
}
else
{
<table class="table table-sm align-middle">
  <thead class="table-light">
    <tr>
      <th>Account</th><th>Payee</th><th class="text-end">Amount</th>
      <th>Date</th><th>Time</th><th>Period</th><th>Status</th><th>Error</th><th></th>
    </tr>
  </thead>
  <tbody>
  @foreach (var b in Model)
  {
    <tr>
      <td>@b.AccountNumber</td>
      <td>@b.Payee?.Name</td>
      <td class="text-end">@b.Amount.ToString("C")</td>
      <td>@D(b.ScheduleTimeUtc)</td>
      <td>@T(b.ScheduleTimeUtc)</td>
      <td>@PeriodText(b.Period)</td>
      <td>@StatusText(b.Status)</td>
      <td>@(string.IsNullOrWhiteSpace(b.LastError) ? "—" : b.LastError)</td>
      <td>
        @if (b.Status == "S")
        {
          <form method="post" asp-action="Cancel">
            <input type="hidden" name="id" value="@b.BillPayID" />
            <button class="btn btn-sm btn-outline-danger">Cancel</button>
          </form>
        }
      </td>
    </tr>
  }
  </tbody>
</table>
}
