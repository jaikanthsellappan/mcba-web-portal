@* Views/Home/Index.cshtml (updated modern layout) *@
@using System.Collections;
@using System.Globalization;

@{
    ViewData["Title"] = "Home";

    var model = ViewData.Model;
    string customerName = "Customer";

    if (model != null)
    {
        var mt = model.GetType();
        var pn = mt.GetProperty("CustomerName");
        if (pn != null)
        {
            var val = pn.GetValue(model) as string;
            if (!string.IsNullOrWhiteSpace(val)) customerName = val!;
        }
        else
        {
            var pc = mt.GetProperty("Customer");
            var custObj = pc?.GetValue(model);
            if (custObj != null)
            {
                var nameProp = custObj.GetType().GetProperty("Name");
                var nameVal = nameProp?.GetValue(custObj) as string;
                if (!string.IsNullOrWhiteSpace(nameVal)) customerName = nameVal!;
            }
        }
    }

    if (ViewBag.CustomerName is string vbName && !string.IsNullOrWhiteSpace(vbName))
        customerName = vbName;

    IEnumerable? accountsObj = null;
    if (model != null)
    {
        var mt = model.GetType();
        var pa = mt.GetProperty("Accounts");
        accountsObj = pa?.GetValue(model) as IEnumerable;
    }
    if (accountsObj is null && ViewBag.Accounts is IEnumerable vbAcc)
        accountsObj = vbAcc;

    string Money(object? amount) =>
        amount is IFormattable f ? f.ToString("C", CultureInfo.CurrentCulture)
                                 : (amount?.ToString() ?? "-");
}

<section class="home-hero">
    <h2 class="mb-1">Welcome, @customerName</h2>
    <div class="muted">Your accounts and quick actions are below.</div>
</section>

@if (accountsObj is null)
{
    <div class="alert alert-info mt-3">
        Your dashboard is ready. Once the controller supplies an <code>Accounts</code> list,
        your balances will appear here.
    </div>
}
else
{
    <div class="accounts-wrap">
        @foreach (var a in accountsObj)
        {
            var t = a!.GetType();
            var accNum = t.GetProperty("AccountNumber")?.GetValue(a);
            var typeRawStr = t.GetProperty("AccountType")?.GetValue(a)?.ToString() ?? "";
            var currentVal = Convert.ToDecimal(t.GetProperty("Balance")?.GetValue(a) ?? 0m);

            var isChecking = string.Equals(typeRawStr, "C", StringComparison.OrdinalIgnoreCase);
            var typeLabel = isChecking ? "Checking" :
                            string.Equals(typeRawStr, "S", StringComparison.OrdinalIgnoreCase) ? "Savings" :
                            (string.IsNullOrWhiteSpace(typeRawStr) ? "—" : typeRawStr);

            var available = isChecking ? Math.Max(0m, currentVal + 500m) : currentVal;

            var cardClass = isChecking ? "account-card checking" : "account-card savings";
            var badgeClass = isChecking ? "badge-checking" : "badge-savings";

            <div class="@cardClass">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <h5 class="card-title mb-2">Account #@accNum</h5>
                        <span class="badge @badgeClass">@typeLabel</span>
                    </div>

                    <p class="mb-1"><strong>Current balance:</strong> @Money(currentVal)</p>
                    <p class="mb-0"><strong>Available balance:</strong> @Money(available)</p>
                </div>

                <div class="card-footer bg-white">
                    <a class="btn btn-sm btn-primary"
                       asp-controller="Statements" asp-action="Index"
                       asp-route-accountNumber="@accNum">View statements</a>

                    <a class="btn btn-sm btn-primary"
                       asp-controller="Transactions" asp-action="Deposit"
                       asp-route-accountNumber="@accNum">Deposit</a>

                    <a class="btn btn-sm btn-primary"
                       asp-controller="Transactions" asp-action="Withdraw"
                       asp-route-accountNumber="@accNum">Withdraw</a>

                    <a class="btn btn-sm btn-primary"
                       asp-controller="Transactions" asp-action="Transfer"
                       asp-route-fromAccountNumber="@accNum">Transfer</a>
                </div>
            </div>
        }
    </div>
}
